# Работа с меню для сайта

## Создание меню

Для создания меню для вашего сайта используйте раздел **"Меню"** в административной панели.

Для начала, вам необходимо создать новый тип меню. Его имя будет псевдонимом для дальнейшего рендеринга в представлениях. Обратите внимание, что имя должно быть уникально, в противном случае, вы получите соответствующую ошибку.

![image](_doc/img/img_001.png)

В дальнейшем, если будет необходимость редактирования вашего меню, вы можете выбрать его из списка в этом же разделе (**"Меню"**):

![image](_doc/img/img_002.png)

После того, как вы создадите новое меню, вы окажитесь на странице его редактирования:

![image](_doc/img/img_003.png)

Здесь представлены следующие формы:

1. Форма для редактирования названия типа меню.
2. Форма для создания структуры меню.
3. Форма для создания элементов меню.

Для начала, вам необходимо в форме создания элементов меню (форма **3**) внести данные для элемента. Для вас есть два раздела, это:

- разделитель. Например, для разделения одного списка.
- свои ссылки. Здесь вы создаете элемент со своей ссылкой.

## Рендеринг меню на странице

Система поддерживает как вывод кастомного меню, так и содержит поддержку разных популярных фреймворков.

Для вывода:

1. В шаблоне, где будет отображаться ваше меню:

```php
{{ Menu::render('site-menu', 'bs4') }}
```

Первый параметр - алиас вашего типа меню. Второй параметр, какой фреймворк для рендеринга вы хотите использовать:

- `bs4`: [Bootstrap 4](https://getbootstrap.com/)
- `materialize`: [Materialize CSS](https://materializecss.com/getting-started.html)

Если вы хотите вывести свой шаблон для рендеринга меню, то вам нужно указать имя шаблона без расширения `.blade.php`. Например, вывод кастомного шаблона:

```php
{{ Menu::render('site-menu', 'custom-menu') }}
```

Обратите внимание, что вызов рендера сгенерирует меню в виде списка. Т.е., для вызова, например, BS4 меню, вам необходимо рендеринг провести в блоке `<nav`:

```html
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    {{ Menu::render('site-menu', 'bs4') }}
</nav>
```

Обратите внимание, что рендерятся фреймворковские шаблоны по умолчанию. Если вы хотите расширить их возможности, то лучше создайте кастомный шаблон.

## Создание кастомного шаблона меню

Все шаблоны меню хранятся в модуле **Admin/Menus**, директория **UI/Views/components/menus**. Создайте в ней файл шаблона, внесите необходимые данные и выведите на своей странице, вызвав:

```php
{{ Menu::render('site-menu', 'custom-menu') }}
```

Вам надо оперировать переменной `$menu`, которая содержит в себе дерево структуры:

- `id` - идентификатор элемента меню
- `type_id` - идентификатор типа меню
- `parent_id` - идентификатор родительского элемента меню
- `position` - позиция сортировки элементов меню
- `name` - имя элемента меню
- `alias` - псевдоним элемента меню
- `route` - ссылка
- `icon` - иконка элемента меню
- `is_separator` - является ли элемент разделителем
- `sub` - массив элементов суб категорий меню

Пример кастомного меню:

```php
@php/** @var \App\Containers\Admin\Menus\Data\Objects\CmsMenuObject $link */ @endphp
<ul>
    @foreach($menu as $link)

        @if($link->is_separator)
            <li class="menu-title">
                {{ $link->name }}
            </li>
            @continue
        @endif

        <li class="@if(count($link->sub)) {{'drop-down'}} @endif">
            <a href="{{ $link->route }}">
                @if($link->icon)
                    <i class="{{ $link->icon }}"></i>
                @endif
                {{ $link->name }}
            </a>
            @if(count($link->sub))
                @include('menus::components.menus.' . $view, [
                    'menu'  => $link->sub,
                ])
            @endif
        </li>
    @endforeach
</ul>
```

Наше меню хранится в переменной `$menu` которую мы и итерируем. Так же, обратите внимание на переменную `$view` - она содержит в себе псевдоним типа нашего кастомного меню.

Для того, что бы определить, что у нас есть выпадающее меню с суб элементам, делаем проверку:

```php
if(count($link->sub)
```

И в случае их наличия, рекурсивно рендерим суб элементы.

## Меню админ панели

Меню админ панели настраивается через конфиг модуля `Menu`. Вам необходим индекс массива `"cms"`:

**Admin/Menus/Configs/menus.php**

```php
'cms' => [
    'dashboard' => [
        'is_separator'  => false,
        'name'          => 'menus::admin-menu.dashboard',
        'route'         => 'dashboard',
        'icon'          => 'la la-dashboard',
    ],

...

    'users' => [
        'is_separator'  => false,
        'name'          => 'menus::admin-menu.users',
        'route'         => 'javascript: void(0);',
        'icon'          => 'la la-user-secret',
        'child' => [
            'employees' => [
                'is_separator'  => false,
                'name'          => 'menus::admin-menu.employees',
                'route'         => 'employees',
                'icon'          => null,
            ],
            'roles' => [
                'is_separator'  => false,
                'name'          => 'menus::admin-menu.roles',
                'route'         => 'roles',
                'icon'          => null,
            ],
        ],
```

Параметры:

- `is_separator`: является ли элемент разделителем, если не указан, то по умолчанию `false`.
- `name`: имя разделителя.
- `route`: роут элемента, если не указан, то по умолчанию `'javascript: void(0);'`
- `icon`: иконка элемента.
- `child`: если ли у элемента дочерние суб элементы. По умолчанию, пустой массив.

После внесение измений в структуру меню для админ панели, обязательно очистите кеш:

```bash
php artisan config:cache
```
